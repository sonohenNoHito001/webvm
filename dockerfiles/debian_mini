#
# WebVM向け 最小構成Rust開発環境 Dockerfile
#
# ベースイメージには、32ビット(i386)アーキテクチャのDebian Bookworm (slim版) を指定。
# これはWebVM/CheerpXの必須要件である。
FROM i386/debian:bookworm-slim

# apt-getを非対話モードで実行するための環境変数。
ENV DEBIAN_FRONTEND=noninteractive

# パッケージのインストールとクリーンアップを単一のRUN命令にまとめることで、
# Dockerイメージのレイヤー数を削減し、最終的なサイズを最適化する。
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
        curl \
        build-essential \
    && \
    # rustupインストーラーをダウンロードし、非対話モード(-y)で実行。
    # これにより、i686-unknown-linux-gnuターゲットのツールチェーンがインストールされる。
    curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y && \
    # インストール後に不要となったパッケージとaptキャッシュを完全に削除する。
    apt-get purge -y --auto-remove curl build-essential && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

# Rustツールチェーンのパスを環境変数PATHに追加する。
# これにより、WebVMのターミナルでcargoやrustcを直接実行できるようになる。
ENV PATH="/root/.cargo/bin:${PATH}"

# WebVM起動時のデフォルトコマンドとしてbashシェルを指定。
CMD ["/bin/bash"]
